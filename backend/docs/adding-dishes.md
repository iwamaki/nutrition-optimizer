# 料理追加ワークフロー

このドキュメントでは、新しい料理をシステムに追加する手順を説明します。

## 概要

料理は `backend/app/data/loader.py` の `SAMPLE_DISHES` に定義します。
各料理は材料（食品）を **文科省食品番号（mext_code）** で参照します。

## 手順

### 1. 材料の食品番号を調べる

CLIツールを使って、材料の文科省食品番号を検索します。

```bash
cd backend
source venv/bin/activate

# キーワード検索（AND検索）
python tools/food_search.py 鶏 もも 焼き

# カテゴリで絞り込み
python tools/food_search.py 鮭 -c 魚介類

# 利用可能なカテゴリ一覧
python tools/food_search.py --categories

# コードで確認
python tools/food_search.py --code 11222
```

**出力例:**
```
検索結果: 2件
--------------------------------------------------------------------------------
コード     食品名                                                カテゴリ
--------------------------------------------------------------------------------
11222  ＜鳥肉類＞　にわとり　［若どり・主品目］　もも　皮つき　焼き   [肉類]
11225  ＜鳥肉類＞　にわとり　［若どり・主品目］　もも　皮なし　焼き   [肉類]
```

### 2. SAMPLE_DISHES に料理を追加

`backend/app/data/loader.py` の `SAMPLE_DISHES` に新しい料理を追加します。

```python
SAMPLE_DISHES = [
    # ... 既存の料理 ...

    # 新しい料理を追加
    {
        "name": "チキンソテー",           # 料理名
        "category": "主菜",               # 主食/主菜/副菜/汁物/デザート
        "meal_types": "lunch,dinner",     # breakfast/lunch/dinner/snack
        "ingredients": [
            {"mext_code": "11222", "amount": 120, "cooking_method": "焼く"},  # 若どりもも焼き
            {"mext_code": "06153", "amount": 20, "cooking_method": "炒める"}, # たまねぎ
        ],
    },
]
```

### 3. データベースを再構築

料理を追加したら、データベースを再構築して反映します。

```bash
# DBファイルを削除
rm nutrition.db

# サーバーを起動（自動的にDBが再構築される）
uvicorn app.main:app --reload
```

### 4. 確認

ヘルスチェックで料理数が増えていることを確認します。

```bash
curl http://localhost:8000/api/v1/health
# {"status":"ok","foods":2538,"dishes":31}
```

## 料理のフィールド説明

| フィールド | 説明 | 例 |
|-----------|------|-----|
| `name` | 料理名（ユニーク） | `"チキンソテー"` |
| `category` | 料理カテゴリ | `"主食"`, `"主菜"`, `"副菜"`, `"汁物"`, `"デザート"` |
| `meal_types` | 提供可能な食事タイプ（カンマ区切り） | `"breakfast,lunch,dinner"` |
| `ingredients` | 材料リスト | 下記参照 |

### ingredients のフィールド

| フィールド | 説明 | 例 |
|-----------|------|-----|
| `mext_code` | 文科省食品番号（5桁） | `"11222"` |
| `amount` | 分量（グラム） | `100` |
| `cooking_method` | 調理法 | `"生"`, `"茹でる"`, `"蒸す"`, `"焼く"`, `"炒める"`, `"揚げる"`, `"煮る"`, `"電子レンジ"` |

## API検索（フロントエンド用）

Web APIからも食品検索が可能です。

```bash
# キーワード検索
curl "http://localhost:8000/api/v1/foods/search?q=鶏"

# コード検索
curl "http://localhost:8000/api/v1/foods/search?code=11222"

# カテゴリ絞り込み
curl "http://localhost:8000/api/v1/foods/search?q=焼き&category=肉類"
```

## よくある食品のmext_code一覧

| 食品 | mext_code | 正式名称 |
|-----|-----------|---------|
| 白ごはん | 01088 | こめ　［水稲めし］　精白米　うるち米 |
| 食パン（焼き） | 01174 | こむぎ　［パン類］　角形食パン　焼き |
| 鶏もも（焼き） | 11222 | にわとり　［若どり・主品目］　もも　皮つき　焼き |
| 豚ロース（焼き） | 11124 | ぶた　［大型種肉］　ロース　脂身つき　焼き |
| 鮭（焼き） | 10136 | （さけ・ます類）　しろさけ　焼き |
| 卵（生） | 12004 | 鶏卵　全卵　生 |
| 木綿豆腐 | 04032 | だいず　［豆腐・油揚げ類］　木綿豆腐 |
| たまねぎ | 06153 | （たまねぎ類）　たまねぎ　りん茎　生 |
| にんじん（ゆで） | 06215 | （にんじん類）　にんじん　根　皮なし　ゆで |
| 牛乳 | 13003 | （液状乳類）　普通牛乳 |
| 味噌 | 17045 | （みそ類）　米みそ　淡色辛みそ |

## 注意事項

- `mext_code` は文科省食品成分表（八訂）のコードです
- 調理法によってコードが異なります（例：鶏もも生 vs 鶏もも焼き）
- 栄養素は100gあたりの値で登録されており、`amount`で分量を指定します
- 料理の栄養素は材料から自動計算されます
